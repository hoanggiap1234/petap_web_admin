jib {
    from {
        image = "adoptopenjdk:8-jre-hotspot"
    }
    to {
        image = "petapp/petapp-service"
        tags = ['latest', version]
    }
    container {
        volumes = ["/app/logs", "/app/storage"]
//        jvmFlags = ["-Xms360m", "-Xmx360m"]
        entrypoint = ["bash", "-c", "/entrypoint.sh"]
        ports = ["8081"]
        environment = [
            SPRING_OUTPUT_ANSI_ENABLED: "ALWAYS",
            STARTUP_SLEEP             : "0"
        ]
        creationTime = "USE_CURRENT_TIMESTAMP"
        user = 1000
    }
    extraDirectories {
        paths = file("src/main/docker/jib")
        permissions = ["/entrypoint.sh": "755"]
    }
//    auth {
//        username = ""
//        password = ""
//    }
//    allowInsecureRegistries = false
}

if (project.hasProperty("docker")) {
    processResources {
        filesMatching("**/logback-spring.xml") {
            filter {
                it.replace("#logging.path#", "/app/logs")
            }
        }
    }
} else {
    processResources {
        filesMatching("**/logback-spring.xml") {
            filter {
                it.replace("#logging.path#", "./logs")
            }
        }
    }
}
